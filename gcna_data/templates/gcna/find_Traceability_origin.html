{% extends 'gcna/base2.html' %}

{% block content %}



<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* General Styles */
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .card {
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .card-body {
      padding: 20px;
    }

    h4 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 24px;
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    th,
    td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      font-weight: bold;
      color: #555;
    }

    td {
      color: #777;
    }

    button {
      cursor: pointer;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: #007bff;
      color: #fff;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #0056b3;
    }

    /* Form Styles */
    record {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #555;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    select {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
      font-size: 16px;
      color: #333;
      outline: none;
    }

    #saveButton,
    #closeButton {
      margin-top: 10px;
      background-color: #28a745;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #closeButton {
      background-color: #dc3545;
      margin-left: 10px;
    }

    /* Responsive Styles */
    @media screen and (max-width: 768px) {
      .container {
        max-width: 90%;
      }
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      background-color: #ffffff;
      font-family: Raleway;
      border-radius: 10px;
    }

    .table th, .table td {
      padding: 10px;
      text-align: center;
      border: 1px solid #e4e4e4;
      min-width: 150px;
    }

    .table th {
      background-color: #f8f9fa;
      font-weight: bold;
    }

    .form-control {
      width: 100%;
      min-width: 150px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 14px;
    }

    .add-row, .submit_contents {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      font-size: 14px;
    }

    .add-row:hover, .submit_contents:hover {
      background-color: #0056b3;
    }

    .addrow, .submit_contents {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      font-size: 14px;
    }

    .addrow:hover, .submit_contents:hover {
      background-color: #0056b3;
    }

    #entryCheck {
      display: none;
    }

    .hidden-label1 {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      display: block;
    }

    @media (max-width: 768px) {
      .table th, .table td {
        min-width: 120px;
      }

      .form-control {
        min-width: 120px;
        font-size: 12px;
      }

      .add-row, .submit_contents {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
<input type="text" id="searchfield" placeholder="Enter Batch Code">
<button onclick="sortFromBatchCode(document.getElementById('searchfield').value)">Search</button>




<input type="text" id="searchfield2" placeholder="Enter Control Number">
<button onclick="sortFromBatchCode2(document.getElementById('searchfield2').value)">Search</button>




<div id="BatchNUM">
  <div id="purchaseInfoDataBC"></div>
  <div id="dispatchInfoDataBC"></div>
  <div id="crackedInfoDataBC"></div>
  <div id="floatingInfoDataBC"></div>
  <div id="packageInfoDataBC"></div>
</div>


<div id="ControlNUM">
  <div id="packageInfoDataBC2"></div>
  <div id="floatingInfoDataBC2"></div>
  <div id="crackedInfoDataBC2"></div>
  <div id="dispatchInfoDataBC2"></div>
  <div id="purchaseInfoDataBC2"></div>
</div>




<script>
  function clearDiv() {
  document.getElementById("purchaseInfoDataBC").innerHTML = "";
  document.getElementById("dispatchInfoDataBC").innerHTML = "";
  document.getElementById("crackedInfoDataBC").innerHTML = "";
  document.getElementById("floatingInfoDataBC").innerHTML = "";
  document.getElementById("packageInfoDataBC").innerHTML = "";
 


   document.getElementById("purchaseInfoDataBC2").innerHTML = "";
  document.getElementById("dispatchInfoDataBC2").innerHTML = "";
  document.getElementById("crackedInfoDataBC2").innerHTML = "";
  document.getElementById("floatingInfoDataBC2").innerHTML = "";
  document.getElementById("packageInfoDataBC2").innerHTML = "";
 
}

</script>

 <script>

function sortFromBatchCode2(value){
    clearDiv();
    sortCracked2(value);
    trackCracked2(value);

}
function findBatch(value){
      sortNutmegPurchased2(value);
    sortDispatchValue2(value);
}

function sortNutmegPurchased2(value){
 let openRequest = indexedDB.open("GCNA");
    openRequest.onsuccess = function (event) {
      let db = event.target.result;
      let transaction = db.transaction("In-House-Drying", "readonly");
      let purchaseInfoStore = transaction.objectStore("In-House-Drying");
      let getAllRequest = purchaseInfoStore.getAll();

      getAllRequest.onsuccess = function (event) {
        let purchaseInfoRecords = event.target.result;
        let purchaseInfoDataDiv = document.getElementById("purchaseInfoDataBC");

        purchaseInfoRecords.forEach((record) => {
          // Skip records that are already marked as complete
          if (
            !value.includes(record.Control_number)
          ) {
           console.log(`record ${record.id} does not match `);
           return;
          }

          let entryContainer = document.createElement("div");
          entryContainer.id = `entryContainer_${record.id}`;
          entryContainer.innerHTML = `
              <form>
              <div class="card">
                <div class="card-body">
                  <p class="card-text">
                    <h1>Nutmeg Purchase Form</h1>
                    <table id="vertical-1" class="table table-hover table-light">
                      <tr>
                        <th>Number ${record.id}</th>
                        <th>Station</th>
                        <td>${record.STATION}</td>
                      </tr>  

                      <tr><th>Date of Purchase</th><td>${record.DATE_OF_PURCHASE || 'N/A'}</td></tr>
                                                        <tr><th>Place of Purchase</th><td>${record.PLACE_OF_PURCHASE || 'N/A'}</td></tr>
                                                        <tr><th>Number of Farmers</th><td>${record.TOTAL_NUM_OF_FARMERS || 'N/A'}</td></tr>
                                                        <tr><th>Number of Bags</th><td>${record.NUM_OF_BAGS || 'N/A'}</td></tr>
                                                        <tr><th>Batch Codes</th><td>${record.Control_number}</td></tr>
                                                        <tr><th>Total Nutmegs bought (lbs)</th><td>${record.TOTAL_LBS_NUTMEG_BOUGHT || 'N/A'}</td></tr>
                                                        <tr>
                                                            <th>Dates</th>
                                                            <td>
                                                                <table class="table table-sm table-borderless mb-0">
                                                                    <thead>
                                                                        <tr>
                                                                            <th scope="col" class="small text-muted">Start Drying</th>
                                                                            <th scope="col" class="small text-muted">Approx. End Drying</th>
                                                                            <th scope="col" class="small text-muted">Actual End Drying</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td>${record.START_DRYING_DATE || 'N/A'}</td>
                                                                            <td>${record.APPROX_END_DRYING_DATE || 'N/A'}</td>
                                                                            <td>${record.END_DRYING_DATE || 'N/A'}</td>
                                                                        </tr>
                                                                    </tbody>

                    </table>
                  </p>
                </div>
              </div>
              </form>
              <br> <br> <br>
          `;
                    purchaseInfoDataDiv.appendChild(entryContainer);


        });
      };
    };}
function sortDispatchValue2(value){
 let openRequest = indexedDB.open("GCNA");
    openRequest.onsuccess = function (event) {
      let db = event.target.result;
      let transaction = db.transaction("Dispatch-Of-Dried-Nutmeg", "readonly");
      let crackingInfoStore = transaction.objectStore("Dispatch-Of-Dried-Nutmeg");
      let getAllRequest = crackingInfoStore.getAll();

      getAllRequest.onsuccess = function (event) {
        let crackingInfoRecords = event.target.result;
        let crackingInfoDataDiv = document.getElementById("dispatchInfoDataBC");

        crackingInfoRecords.forEach((record) => {
          // Skip records that are already marked as complete
          if (
             !value.includes(record.BATCH_CODES_DRIED) ||  !value.includes(record.BATCH_CODES_GREEN)
          ) {
           console.log(`record ${record.id} does not match `);
           return;
          }    



          let entryContainer1 = document.createElement("div");
          entryContainer1.id = `entryContainer_${record.id}`;
          entryContainer1.innerHTML = `
              <form>
             <div class="col-md-4 mb-4">
                                <h5>Dried Form Details</h5>
                                <hr>
                                <div class="detail-row">
                                    <span class="detail-label">Station From:</span> ${record.STATION_DRIED || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Station To:</span> ${record.STATION_recieved_DRIED || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Batch Codes:</span><br>
                                    ${record.BATCH_CODES_DRIED ? record.BATCH_CODES_DRIED.split(',').map(code => `<span class="batch-code">${code.trim()}</span>`).join('') : 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Delivery Advice:</span> ${record.CORRESPONDING_DELIVERY_ADVICE || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Product:</span> ${record.Product || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Number of Bags:</span> ${record.Num_Bags_DRIED || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Weight:</span> ${record.Weight || 'N/A'}
                                </div>
                            </div>
                                          </form>
              <br> <br> <br>
          `;
                    
          
          let entryContainer2 = document.createElement("div");
          entryContainer2.id = `entryContainer_${record.id}`;
          entryContainer2.innerHTML = `
              <form>
                <div class="col-md-4 mb-4">
                                <h5>Green Form Details</h5>
                                <hr>
                                <div class="detail-row">
                                    <span class="detail-label">Date:</span> ${record.DATE_CREATED || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Station:</span> ${record.STATION_GREEN || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Date of Purchase:</span> ${record.DATE_OF_PURCHASE_GREEN || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Total Farmers:</span> ${record.TOTAL_NUM_OF_FARMERS_GREEN || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Total Lbs Bought:</span> ${record.TOTAL_LBS_NUTMEG_BOUGHT_GREEN || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Batch Codes:</span><br>
                                    ${record.BATCH_CODES_GREEN ? record.BATCH_CODES_GREEN.split(',').map(code => `<span class="batch-code">${code.trim()}</span>`).join('') : 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Number of Bags:</span> ${record.NUM_OF_BAGS_GREEN || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Delivery Advice:</span> ${record.DELIVERY_ADVICE_NUMBER || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Warehouse Receipt:</span> ${record.WAREHOUSE_RECEIPT_NUMBER || 'N/A'}
                                </div>
                            </div>
                                          </form>
              <br> <br> <br>
          `;
                    
          
          if(record.BATCH_CODES_DRIED ==value){
          crackingInfoDataDiv.appendChild(entryContainer1);

          }else if(record.BATCH_CODES_GREEN ==value){
          crackingInfoDataDiv.appendChild(entryContainer2);

          }else{
            console.log('No Matching Dispatch')
          }


          


        });
      };



    };
}

function sortCracked2(value){
    let openRequest = indexedDB.open("GCNA");
    openRequest.onsuccess = function (event) {
      let db = event.target.result;
      let transaction = db.transaction("Cracking-Summary", "readonly");
      let crackingInfoStore = transaction.objectStore("Cracking-Summary");
      let getAllRequest = crackingInfoStore.getAll();

      getAllRequest.onsuccess = function (event) {
        let crackingInfoRecords = event.target.result;
        let crackingInfoDataDiv = document.getElementById("crackedInfoDataBC");

        crackingInfoRecords.forEach((record) => {
          // Skip records that are already marked as complete
          if (
            !record.Control_Num.includes(value)
          ) {
           console.log(`record ${record.id} does not match `);
           return;
          }

          let entryContainer = document.createElement("div");
          entryContainer.id = `entryContainer_${record.id}`;
          entryContainer.innerHTML = `
              <form>
              <div class="card">
                <div class="card-body">
                                 <h1>Cracked Nutmeg Form</h1>

                  <p class="card-text">
                    <table id="vertical-1" class="table table-hover table-light">
                      <tr>
                        <th>Station</th>
                        <td>${record.STATION}</td>
                      </tr>  
                      <tr>
                        <th>Date of Cracking</th>
                        <td>${record.DATE_OF_CRACKING}</td>
                      </tr>
                      <tr>
                        <th>Delivery Advice Number</th>
                        <td>${record.Delivery_Advice_Num}</td>
                      </tr>
                      <tr>
                        <th>Warehouse Receipt Numbers</th>
                        <td>${record.WAREHOUSE_RECEIPT_NUMBERS}</td>
                      </tr>
                      <tr>
                        <th>Number of Bags</th>
                        <td>${record.NUM_OF_BAGS}</td>
                      </tr>
                      <tr>
                        <th>LBS of Nutmegs Cracked</th>
                        <td>${record.LBS_OF_NUTMEGS_CRACKED}</td>
                      </tr>
                      <tr>
                        <th>Batch Codes</th>
                        <td>${record.BatchCodes}</td>
                      </tr>
                      <tr>
                        <th>Control Number</th>
                        <td>${record.Control_Num}</td>
                      </tr>
                      <tr>
                        <th>Number of Nutmeg Pieces (lbs)</th>
                        <td>${record.num_pieces}</td>
                      </tr>
                      <tr>
                        <th>Number of Nutmeg Fragments (lbs)</th>
                        <td>${record.fragments}</td>
                      </tr>
                      <tr>
                        <th>Number of Regular Nutmeg (lbs)</th>
                        <td>${record.regular_nutmeg}</td>
                      </tr>
                      <tr>
                        <th>Number of Nutmeg Escapes (lbs)</th>
                        <td>${record.escape_nutmeg}</td>
                      </tr>
                      
                    </table>
                  </p>
                </div>
              </div>
              </form>
              <br> <br> <br>
          `;
                    crackingInfoDataDiv.appendChild(entryContainer);
                    findBatch(record.BatchCodes)

        });
      };
    };
}

function trackCracked2(value){
  console.log('triggered')
  let openRequest = indexedDB.open("GCNA");
    openRequest.onsuccess = function (event) {
      let db = event.target.result;

      let transaction = db.transaction(["Floation-Summary", "M_Shelves"], "readonly");
      let crackingInfoStore = transaction.objectStore("Floation-Summary");
      let getAllRequest = crackingInfoStore.getAll();

      let transaction2 = db.transaction("Package-Ciontrol", "readonly");
      let packageInfoStore2 = transaction2.objectStore("Package-Ciontrol");
      let getAllRequest2 = packageInfoStore2.getAll();
      let shelvesStore = transaction.objectStore("M_Shelves");



      getAllRequest.onsuccess = function (event) {
        let floatingInfoRecords = event.target.result;
        let floatingInfoDataDiv = document.getElementById("floatingInfoDataBC");

        // Get all shelves data
        let getAllShelvesRequest = shelvesStore.getAll();
        getAllShelvesRequest.onsuccess = function(event) {
          let allShelves = event.target.result;
          
          floatingInfoRecords.forEach((record) => {
            // Skip records that are already marked as complete
            if (
              record.Control_NUMBER !== value
            ) {
              console.log(record.Control_NUMBER)
              return;
            }

            // Filter shelves that match this entry's entryCheck value
            let matchingShelves = allShelves.filter(shelf => 
              shelf.entry === record.entryCheck
            );

            let entryContainer = document.createElement("div");
            entryContainer.id = `entryContainer_${record.id}`;
            entryContainer.innerHTML = `
                <form>
                <div class="card">
                  <div class="card-body">
                  <h1>Floation Form</h1>

                    <p class="card-text">
                      <table id="vertical-1" class="table table-hover table-light">
                        <tr>
                          <th>Station</th>
                          <td>${record.STATION}</td>
                        </tr>
                        <tr>
                          <th>Control Number</th>
                          <td>${record.Control_NUMBER}</td>
                        </tr>
                        <td id="entryCheck" style="opacity: 0;">${record.entryCheck}</td>
                      </table>

                      <table class="table">
                        <center>
                          <label>Dates</label>   
                        </center> 
                        <thead>
                          <tr>
                            <th scope="col">Start Drying Date</th>
                            <th scope="col">Approximate End Drying Date</th>
                            <th scope="col">End Drying Date</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td><input type="date" class="form-control" value="${record.START_DRYING_DATE || ''}" 
                                onchange="saveEditedDate2(${record.id}, this.value)" readonly></td>       
                            <td>
                              <input type="date" class="form-control" id="date-${record.id}" value="${record.APPROX_END_DRYING_DATE || ''}" readonly>
                            </td>
                            <td><input type="date" class="form-control" value="${record.END_DRYING_DATE || ''}" 
                                onchange="saveEditedDate(${record.id}, this.value)" readonly></td>
                          </tr>
                        </tbody>
                      </table>
                    </p>
                  </div>
                </div>
            `;


            // Add the shelves section if there are matching shelves
            if (matchingShelves.length > 0) {
              let shelvesHTML = `
                <div class="card">
                  <div class="card-body">
                    <p class="card-text">
                      <center>
                        <p><b>ADDED SHELVES</b></p>
                      </center>
                      
                      <table class="table" id="shelves-table-${record.id}">
                        <thead>
                          <tr>
                            <th scope="col">Floor</th>
                            <th scope="col">Shelf</th>
                            <th scope="col">Tray</th>
                            <th scope="col">Section</th>
                            <th scope="col">Moisture</th>
                            <th scope="col">Weight</th>
                            <th scope="col">Date</th>
                            <th scope="col">Actions</th>
                          </tr>
                        </thead>
                        <tbody>
              `;

              matchingShelves.forEach((shelf, index) => {
                shelvesHTML += `
                  <tr id="shelf-row-${shelf.id}">
                    <td><input type="text" class="form-control" value="${shelf.floor || ''}" onchange="updateShelfField(${shelf.id}, 'floor', this.value)" readonly></td>
                    <td><input type="text" class="form-control" value="${shelf.M_Shelf || ''}" onchange="updateShelfField(${shelf.id}, 'M_Shelf', this.value)" readonly></td>
                    <td><input type="text" class="form-control" value="${shelf.M_Tray || ''}" onchange="updateShelfField(${shelf.id}, 'M_Tray', this.value)" readonly></td>
                    <td><input type="text" class="form-control" value="${shelf.M_Section || ''}" onchange="updateShelfField(${shelf.id}, 'M_Section', this.value)" readonly></td>
                    <td><input type="text" class="form-control" value="${shelf.Moisture || ''}" onchange="updateShelfField(${shelf.id}, 'Moisture', this.value)" readonly></td>
                    <td><input type="text" class="form-control" value="${shelf.Weight || ''}" onchange="updateShelfField(${shelf.id}, 'Weight', this.value)" readonly></td>
                    <td><input type="date" class="form-control" value="${shelf.Date || ''}" onchange="updateShelfField(${shelf.id}, 'Date', this.value)" readonly></td>
                    <td>
                    </td>
                  </tr>
                `;
              });

              shelvesHTML += `
                        </tbody>
                      </table>
                    </p>
                  </div>
                </div>
              `;

              entryContainer.innerHTML += shelvesHTML;
            } else {
              // If no shelves yet, still add the button to add new shelves
              entryContainer.innerHTML += `
                <div class="card">
                
                </div>
              `;
            }

            floatingInfoDataDiv.appendChild(entryContainer);
      });
        };
      };
   





      
      getAllRequest2.onsuccess = function (event) {
        let crackingInfoRecords = event.target.result;
        let crackingInfoDataDiv = document.getElementById("packageInfoDataBC");

        crackingInfoRecords.forEach((record) => {
          // Skip records that are already marked as complete
      if (
              record.BATCH_NUMBER !== value
            ) {
              console.log(record.BATCH_NUMBER)
              return;
            }

          let entryContainer = document.createElement("div");
          entryContainer.id = `entryContainer_${record.id}`;
          entryContainer.innerHTML = `
              <form>
          
            <div class="card">
 
                <div class="card-body">
                                <h1>Packaging Form</h1>

                </h5>
                  <p class="card-text">
                      <table id="vertical-1" class="table table-hover table-light">
                     
              
              
                     <tr>
              
                          <th>Product Descriptions</th>
                          <td>${ record.PRODUCT_DESCRIPTION }</td>
                      </tr>  
                      <tr>
                          <th>Start Date</th>
                          <td>${ record.START }</td>
                      </tr>
                      <tr>
                          <th>End Date</th>
                          <td>${ record.END }</td>
                      </tr>
                      <tr>
                          <th>Quantity of bags</th>
                          <td>${ record.QUANTITY_OF_BAGS }</td>
                      </tr>
              
              
                      <tr>
                          <th>Total Weight(lbs)</th>
                          <td>${ record.TOTAL_WEIGHT_LBS }</td>
                      </tr>
              
              
              
                      <tr>
                          <th>Package Material</th>
                          <td>${ record.PACKAGING_MATERIAL }</td>
                      </tr>
              
              
              
                      <tr>
                          <th>Batch Number</th>
                          <td>${ record.BATCH_NUMBER }</td>
                      </tr>
                      <tr>
                          <th>Contract Number</th>
                          <td>${ record.CONTRACT_NUMBER }</td>
                      </tr>
                      <tr>
                          <th>Offical Lab Results</th>
                          <td>${ record.OFFICIAL_LAB_RESULTS }</td>
                      </tr>
              
                  </table>
                  
              
              
              
                                  </p>
              
              
              
                     
               </div>        </div>
              
              <br>
              <br>
              <br>
              
              </form>
              <br> <br> <br>
          `;
                    crackingInfoDataDiv.appendChild(entryContainer);

        });
      };


}
}

   
  </script>














 <script>

function sortFromBatchCode(value){
    clearDiv();
    sortNutmegPurchased(value);
    sortDispatchValue(value);
    sortCracked(value);
    // trackCracked(value);

}


function sortNutmegPurchased(value){
 let openRequest = indexedDB.open("GCNA");
    openRequest.onsuccess = function (event) {
      let db = event.target.result;
      let transaction = db.transaction("In-House-Drying", "readonly");
      let purchaseInfoStore = transaction.objectStore("In-House-Drying");
      let getAllRequest = purchaseInfoStore.getAll();

      getAllRequest.onsuccess = function (event) {
        let purchaseInfoRecords = event.target.result;
        let purchaseInfoDataDiv = document.getElementById("purchaseInfoDataBC");

        purchaseInfoRecords.forEach((record) => {
          // Skip records that are already marked as complete
          if (
            record.Control_number != value
          ) {
           console.log(`record ${record.id} does not match `);
           return;
          }

          let entryContainer = document.createElement("div");
          entryContainer.id = `entryContainer_${record.id}`;
          entryContainer.innerHTML = `
              <form>
              <div class="card">
                <div class="card-body">
                  <p class="card-text">
                    <h1>Nutmeg Purchase Form</h1>
                    <table id="vertical-1" class="table table-hover table-light">
                      <tr>
                        <th>Number ${record.id}</th>
                        <th>Station</th>
                        <td>${record.STATION}</td>
                      </tr>  

                      <tr><th>Date of Purchase</th><td>${record.DATE_OF_PURCHASE || 'N/A'}</td></tr>
                                                        <tr><th>Place of Purchase</th><td>${record.PLACE_OF_PURCHASE || 'N/A'}</td></tr>
                                                        <tr><th>Number of Farmers</th><td>${record.TOTAL_NUM_OF_FARMERS || 'N/A'}</td></tr>
                                                        <tr><th>Number of Bags</th><td>${record.NUM_OF_BAGS || 'N/A'}</td></tr>
                                                        <tr><th>Batch Codes</th><td>${record.Control_number}</td></tr>
                                                        <tr><th>Total Nutmegs bought (lbs)</th><td>${record.TOTAL_LBS_NUTMEG_BOUGHT || 'N/A'}</td></tr>
                                                        <tr>
                                                            <th>Dates</th>
                                                            <td>
                                                                <table class="table table-sm table-borderless mb-0">
                                                                    <thead>
                                                                        <tr>
                                                                            <th scope="col" class="small text-muted">Start Drying</th>
                                                                            <th scope="col" class="small text-muted">Approx. End Drying</th>
                                                                            <th scope="col" class="small text-muted">Actual End Drying</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td>${record.START_DRYING_DATE || 'N/A'}</td>
                                                                            <td>${record.APPROX_END_DRYING_DATE || 'N/A'}</td>
                                                                            <td>${record.END_DRYING_DATE || 'N/A'}</td>
                                                                        </tr>
                                                                    </tbody>

                    </table>
                  </p>
                </div>
              </div>
              </form>
              <br> <br> <br>
          `;
                    purchaseInfoDataDiv.appendChild(entryContainer);


        });
      };
    };}
function sortDispatchValue(value){
 let openRequest = indexedDB.open("GCNA");
    openRequest.onsuccess = function (event) {
      let db = event.target.result;
      let transaction = db.transaction("Dispatch-Of-Dried-Nutmeg", "readonly");
      let crackingInfoStore = transaction.objectStore("Dispatch-Of-Dried-Nutmeg");
      let getAllRequest = crackingInfoStore.getAll();

      getAllRequest.onsuccess = function (event) {
        let crackingInfoRecords = event.target.result;
        let crackingInfoDataDiv = document.getElementById("dispatchInfoDataBC");

        crackingInfoRecords.forEach((record) => {
          // Skip records that are already marked as complete
          if (
            record.BATCH_CODES_DRIED !=value && record.BATCH_CODES_GREEN !=value
          ) {
           console.log(`record ${record.id} does not match `);
           return;
          }    



          let entryContainer1 = document.createElement("div");
          entryContainer1.id = `entryContainer_${record.id}`;
          entryContainer1.innerHTML = `
              <form>
             <div class="col-md-4 mb-4">
                                <h5>Dried Form Details</h5>
                                <hr>
                                <div class="detail-row">
                                    <span class="detail-label">Station From:</span> ${record.STATION_DRIED || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Station To:</span> ${record.STATION_recieved_DRIED || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Batch Codes:</span><br>
                                    ${record.BATCH_CODES_DRIED ? record.BATCH_CODES_DRIED.split(',').map(code => `<span class="batch-code">${code.trim()}</span>`).join('') : 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Delivery Advice:</span> ${record.CORRESPONDING_DELIVERY_ADVICE || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Product:</span> ${record.Product || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Number of Bags:</span> ${record.Num_Bags_DRIED || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Weight:</span> ${record.Weight || 'N/A'}
                                </div>
                            </div>
                                          </form>
              <br> <br> <br>
          `;
                    
          
          let entryContainer2 = document.createElement("div");
          entryContainer2.id = `entryContainer_${record.id}`;
          entryContainer2.innerHTML = `
              <form>
                <div class="col-md-4 mb-4">
                                <h5>Green Form Details</h5>
                                <hr>
                                <div class="detail-row">
                                    <span class="detail-label">Date:</span> ${record.DATE_CREATED || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Station:</span> ${record.STATION_GREEN || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Date of Purchase:</span> ${record.DATE_OF_PURCHASE_GREEN || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Total Farmers:</span> ${record.TOTAL_NUM_OF_FARMERS_GREEN || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Total Lbs Bought:</span> ${record.TOTAL_LBS_NUTMEG_BOUGHT_GREEN || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Batch Codes:</span><br>
                                    ${record.BATCH_CODES_GREEN ? record.BATCH_CODES_GREEN.split(',').map(code => `<span class="batch-code">${code.trim()}</span>`).join('') : 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Number of Bags:</span> ${record.NUM_OF_BAGS_GREEN || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Delivery Advice:</span> ${record.DELIVERY_ADVICE_NUMBER || 'N/A'}
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Warehouse Receipt:</span> ${record.WAREHOUSE_RECEIPT_NUMBER || 'N/A'}
                                </div>
                            </div>
                                          </form>
              <br> <br> <br>
          `;
                    
          
          if(record.BATCH_CODES_DRIED ==value){
          crackingInfoDataDiv.appendChild(entryContainer1);

          }else if(record.BATCH_CODES_GREEN ==value){
          crackingInfoDataDiv.appendChild(entryContainer2);

          }else{
            console.log('No Matching Dispatch')
          }


          


        });
      };



    };
}

function sortCracked(value){
    let openRequest = indexedDB.open("GCNA");
    openRequest.onsuccess = function (event) {
      let db = event.target.result;
      let transaction = db.transaction("Cracking-Summary", "readonly");
      let crackingInfoStore = transaction.objectStore("Cracking-Summary");
      let getAllRequest = crackingInfoStore.getAll();

      getAllRequest.onsuccess = function (event) {
        let crackingInfoRecords = event.target.result;
        let crackingInfoDataDiv = document.getElementById("crackedInfoDataBC");

        crackingInfoRecords.forEach((record) => {
          // Skip records that are already marked as complete
          if (
            !record.BatchCodes.includes(value)
          ) {
           console.log(`record ${record.id} does not match `);
           return;
          }

          let entryContainer = document.createElement("div");
          entryContainer.id = `entryContainer_${record.id}`;
          entryContainer.innerHTML = `
              <form>
              <div class="card">
                <div class="card-body">
                                 <h1>Cracked Nutmeg Form</h1>

                  <p class="card-text">
                    <table id="vertical-1" class="table table-hover table-light">
                      <tr>
                        <th>Station</th>
                        <td>${record.STATION}</td>
                      </tr>  
                      <tr>
                        <th>Date of Cracking</th>
                        <td>${record.DATE_OF_CRACKING}</td>
                      </tr>
                      <tr>
                        <th>Delivery Advice Number</th>
                        <td>${record.Delivery_Advice_Num}</td>
                      </tr>
                      <tr>
                        <th>Warehouse Receipt Numbers</th>
                        <td>${record.WAREHOUSE_RECEIPT_NUMBERS}</td>
                      </tr>
                      <tr>
                        <th>Number of Bags</th>
                        <td>${record.NUM_OF_BAGS}</td>
                      </tr>
                      <tr>
                        <th>LBS of Nutmegs Cracked</th>
                        <td>${record.LBS_OF_NUTMEGS_CRACKED}</td>
                      </tr>
                      <tr>
                        <th>Batch Codes</th>
                        <td>${record.BatchCodes}</td>
                      </tr>
                      <tr>
                        <th>Control Number</th>
                        <td>${record.Control_Num}</td>
                      </tr>
                      <tr>
                        <th>Number of Nutmeg Pieces (lbs)</th>
                        <td>${record.num_pieces}</td>
                      </tr>
                      <tr>
                        <th>Number of Nutmeg Fragments (lbs)</th>
                        <td>${record.fragments}</td>
                      </tr>
                      <tr>
                        <th>Number of Regular Nutmeg (lbs)</th>
                        <td>${record.regular_nutmeg}</td>
                      </tr>
                      <tr>
                        <th>Number of Nutmeg Escapes (lbs)</th>
                        <td>${record.escape_nutmeg}</td>
                      </tr>
                      
                    </table>
                  </p>
                </div>
              </div>
              </form>
              <br> <br> <br>
          `;
                    crackingInfoDataDiv.appendChild(entryContainer);
                    trackCracked(record.Control_Num)

        });
      };
    };
}

function trackCracked(value){
  console.log('triggered')
  let openRequest = indexedDB.open("GCNA");
    openRequest.onsuccess = function (event) {
      let db = event.target.result;

      let transaction = db.transaction(["Floation-Summary", "M_Shelves"], "readonly");
      let crackingInfoStore = transaction.objectStore("Floation-Summary");
      let getAllRequest = crackingInfoStore.getAll();

      let transaction2 = db.transaction("Package-Ciontrol", "readonly");
      let packageInfoStore2 = transaction2.objectStore("Package-Ciontrol");
      let getAllRequest2 = packageInfoStore2.getAll();
      let shelvesStore = transaction.objectStore("M_Shelves");



      getAllRequest.onsuccess = function (event) {
        let floatingInfoRecords = event.target.result;
        let floatingInfoDataDiv = document.getElementById("floatingInfoDataBC");

        // Get all shelves data
        let getAllShelvesRequest = shelvesStore.getAll();
        getAllShelvesRequest.onsuccess = function(event) {
          let allShelves = event.target.result;
          
          floatingInfoRecords.forEach((record) => {
            // Skip records that are already marked as complete
            if (
              record.Control_NUMBER !== value
            ) {
              console.log(record.Control_NUMBER)
              return;
            }

            // Filter shelves that match this entry's entryCheck value
            let matchingShelves = allShelves.filter(shelf => 
              shelf.entry === record.entryCheck
            );

            let entryContainer = document.createElement("div");
            entryContainer.id = `entryContainer_${record.id}`;
            entryContainer.innerHTML = `
                <form>
                <div class="card">
                  <div class="card-body">
                  <h1>Floation Form</h1>

                    <p class="card-text">
                      <table id="vertical-1" class="table table-hover table-light">
                        <tr>
                          <th>Station</th>
                          <td>${record.STATION}</td>
                        </tr>
                        <tr>
                          <th>Control Number</th>
                          <td>${record.Control_NUMBER}</td>
                        </tr>
                        <td id="entryCheck" style="opacity: 0;">${record.entryCheck}</td>
                      </table>

                      <table class="table">
                        <center>
                          <label>Dates</label>   
                        </center> 
                        <thead>
                          <tr>
                            <th scope="col">Start Drying Date</th>
                            <th scope="col">Approximate End Drying Date</th>
                            <th scope="col">End Drying Date</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td><input type="date" class="form-control" value="${record.START_DRYING_DATE || ''}" 
                                onchange="saveEditedDate2(${record.id}, this.value)" readonly></td>       
                            <td>
                              <input type="date" class="form-control" id="date-${record.id}" value="${record.APPROX_END_DRYING_DATE || ''}" readonly>
                            </td>
                            <td><input type="date" class="form-control" value="${record.END_DRYING_DATE || ''}" 
                                onchange="saveEditedDate(${record.id}, this.value)" readonly></td>
                          </tr>
                        </tbody>
                      </table>
                    </p>
                  </div>
                </div>
            `;


            // Add the shelves section if there are matching shelves
            if (matchingShelves.length > 0) {
              let shelvesHTML = `
                <div class="card">
                  <div class="card-body">
                    <p class="card-text">
                      <center>
                        <p><b>ADDED SHELVES</b></p>
                      </center>
                      
                      <table class="table" id="shelves-table-${record.id}">
                        <thead>
                          <tr>
                            <th scope="col">Floor</th>
                            <th scope="col">Shelf</th>
                            <th scope="col">Tray</th>
                            <th scope="col">Section</th>
                            <th scope="col">Moisture</th>
                            <th scope="col">Weight</th>
                            <th scope="col">Date</th>
                            <th scope="col">Actions</th>
                          </tr>
                        </thead>
                        <tbody>
              `;

              matchingShelves.forEach((shelf, index) => {
                shelvesHTML += `
                  <tr id="shelf-row-${shelf.id}">
                    <td><input type="text" class="form-control" value="${shelf.floor || ''}" onchange="updateShelfField(${shelf.id}, 'floor', this.value)" readonly></td>
                    <td><input type="text" class="form-control" value="${shelf.M_Shelf || ''}" onchange="updateShelfField(${shelf.id}, 'M_Shelf', this.value)" readonly></td>
                    <td><input type="text" class="form-control" value="${shelf.M_Tray || ''}" onchange="updateShelfField(${shelf.id}, 'M_Tray', this.value)" readonly></td>
                    <td><input type="text" class="form-control" value="${shelf.M_Section || ''}" onchange="updateShelfField(${shelf.id}, 'M_Section', this.value)" readonly></td>
                    <td><input type="text" class="form-control" value="${shelf.Moisture || ''}" onchange="updateShelfField(${shelf.id}, 'Moisture', this.value)" readonly></td>
                    <td><input type="text" class="form-control" value="${shelf.Weight || ''}" onchange="updateShelfField(${shelf.id}, 'Weight', this.value)" readonly></td>
                    <td><input type="date" class="form-control" value="${shelf.Date || ''}" onchange="updateShelfField(${shelf.id}, 'Date', this.value)" readonly></td>
                    <td>
                    </td>
                  </tr>
                `;
              });

              shelvesHTML += `
                        </tbody>
                      </table>
                    </p>
                  </div>
                </div>
              `;

              entryContainer.innerHTML += shelvesHTML;
            } else {
              // If no shelves yet, still add the button to add new shelves
              entryContainer.innerHTML += `
                <div class="card">
                
                </div>
              `;
            }

            floatingInfoDataDiv.appendChild(entryContainer);
      });
        };
      };
   





      
      getAllRequest2.onsuccess = function (event) {
        let crackingInfoRecords = event.target.result;
        let crackingInfoDataDiv = document.getElementById("packageInfoDataBC");

        crackingInfoRecords.forEach((record) => {
          // Skip records that are already marked as complete
      if (
              record.BATCH_NUMBER !== value
            ) {
              console.log(record.BATCH_NUMBER)
              return;
            }

          let entryContainer = document.createElement("div");
          entryContainer.id = `entryContainer_${record.id}`;
          entryContainer.innerHTML = `
              <form>
          
            <div class="card">
 
                <div class="card-body">
                                <h1>Packaging Form</h1>

                </h5>
                  <p class="card-text">
                      <table id="vertical-1" class="table table-hover table-light">
                     
              
              
                     <tr>
              
                          <th>Product Descriptions</th>
                          <td>${ record.PRODUCT_DESCRIPTION }</td>
                      </tr>  
                      <tr>
                          <th>Start Date</th>
                          <td>${ record.START }</td>
                      </tr>
                      <tr>
                          <th>End Date</th>
                          <td>${ record.END }</td>
                      </tr>
                      <tr>
                          <th>Quantity of bags</th>
                          <td>${ record.QUANTITY_OF_BAGS }</td>
                      </tr>
              
              
                      <tr>
                          <th>Total Weight(lbs)</th>
                          <td>${ record.TOTAL_WEIGHT_LBS }</td>
                      </tr>
              
              
              
                      <tr>
                          <th>Package Material</th>
                          <td>${ record.PACKAGING_MATERIAL }</td>
                      </tr>
              
              
              
                      <tr>
                          <th>Batch Number</th>
                          <td>${ record.BATCH_NUMBER }</td>
                      </tr>
                      <tr>
                          <th>Contract Number</th>
                          <td>${ record.CONTRACT_NUMBER }</td>
                      </tr>
                      <tr>
                          <th>Offical Lab Results</th>
                          <td>${ record.OFFICIAL_LAB_RESULTS }</td>
                      </tr>
              
                  </table>
                  
              
              
              
                                  </p>
              
              
              
                     
               </div>        </div>
              
              <br>
              <br>
              <br>
              
              </form>
              <br> <br> <br>
          `;
                    crackingInfoDataDiv.appendChild(entryContainer);

        });
      };


}
}

   
  </script>

  </body>

{% endblock %}
