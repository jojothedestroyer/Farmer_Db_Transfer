{% extends 'gcna/base2.html' %} {% block content%}


<!DOCTYPE html>
<html lang="en">

<head></head>

<body>

    <div class="container">
        <div class="form-container">
            <div class="form-header">
                <h6>Document No. GCNA-GMP</h6>
                <h6>Document Title: Nutmeg Processing Forms</h6>
                <h6>Date Issued: <span id="current-date"></span></h6>
                <h6>Version: 1.0</h6>
            </div>

            <h1 class="text-center mb-4">Stirring Log</h1>

            <div class="form-check-section mb-4">
                <h5>Select Form to Display:</h5>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="maceCheck">
                    <label class="form-check-label" for="maceCheck">Make Log</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="driedCheck">
                    <label class="form-check-label" for="driedCheck">View Logs</label>
                </div>

            </div>


            <div id='stir-add'>

                <form id="submitForm" method="POST" enctype="multipart/form-data">
                    <div>

                        <div>
                            <label for="">Date</label>
                            <input type="date" name="date" id="date">
                        </div>


                        <div>
                            <label for="">Time Started</label>
                            <input type="time" name="time-started" id="time-started">
                        </div>


                        <div>
                            <label for="">Signed by:</label>
                            <input type="text" name="signed-by" id="signed-by">
                        </div>

                    </div>




                    <button type=" submit" name="" value="submit" class="btn btn-success">Submit</button>

                </form>
            </div>

            <div>


            </div id='stir-view'>

            <div id="landInfoData"></div>

        </div>

    </div>

    </div>
</body>
<script>
    let openRequest = indexedDB.open("GCNA");

    openRequest.onsuccess = function (event) {
        let db = event.target.result;
        let transaction = db.transaction("Stirring-Log", "readonly");
        let landInfoStore = transaction.objectStore("Stirring-Log");
        let getAllRequest = landInfoStore.getAll();

        getAllRequest.onsuccess = function (event) {
            let landInfoRecords = event.target.result;
            let landInfoDataDiv = document.getElementById("landInfoData");


            landInfoRecords.forEach((record) => {



                let entryContainer = document.createElement("div");
                entryContainer.id = `entryContainer_${record.id}`;
                entryContainer.innerHTML = `
                <div class="card">
 
                    <div class="card-body">
                  
                    </h5>
                      <p class="card-text">
                          <table id="vertical-1" class="table table-hover table-light">
                         
           


        <tr>
            <th>Date</th>
            <td>${record.date}</td>
        </tr>
    <tr>
            <th>Time Started</th>
            <td>${record.time - started}</td>
        </tr>


        <tr>
            <th>Signed By</th>
            <td>${record.signed - by}</td>
        </tr>
    <tr>
            <th>ID</th>
            <td>${record.id}</td>
        </tr>


       
                  
                         
                      </table>
                    
                     </div>
                 </div>
                 <br> <br> <br>

             `;
                landInfoDataDiv.appendChild(entryContainer);

            });
        };
    };



</script>




<script>
    document.addEventListener('DOMContentLoaded', function () {
        var submitForm = document.getElementById('submitForm');
        submitForm.addEventListener('submit', function (event) {
            event.preventDefault();
            var data = new FormData(event.target);
            saveToIndexedDB(data);
        });

        function saveToIndexedDB(data) {
            data.delete('csrfmiddlewaretoken')
            var request = indexedDB.open('GCNA', 2);
            request.onsuccess = function (event) {
                var db = event.target.result;
                var transaction = db.transaction('Stirring-Log', 'readwrite');
                var objectStore = transaction.objectStore('Stirring-Log');
                var obj = {};
                for (var pair of data.entries()) {
                    obj[pair[0]] = pair[1];
                }

                var highestIdRequest = objectStore.openCursor(null, 'prev');
                highestIdRequest.onsuccess = function (event) {
                    var cursor = event.target.result;
                    obj.id = cursor ? cursor.key + 1 : 1;
                    var request = objectStore.put(obj);

                    request.onsuccess = function () {
                        console.log('Data added to IndexedDB');
                        transferIndexedDBData();
                    };

                    request.onerror = function () {
                        console.error('Error adding data to IndexedDB');
                    };
                };
            };



            function transferIndexedDBData() {
                var request = indexedDB.open('GCNA', 2);

                request.onsuccess = function (event) {
                    var db = event.target.result;
                    var transaction = db.transaction('Stirring-Log', 'readonly');
                    var objectStore = transaction.objectStore('Stirring-Log');
                    var getRequest = objectStore.getAll();

                    getRequest.onsuccess = function (event) {
                        var data = event.target.result;
                        data.forEach(function (item) {
                            // sendDataToDjango(item);
                        });
                        window.location.reload();
                    };
                };

                request.onerror = function (event) {
                    console.error('Error opening IndexedDB', event);
                };
            }


            request.onerror = function (event) {
                console.error('Error opening IndexedDB', event);
            };
        }



    })
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>

{% endblock %}